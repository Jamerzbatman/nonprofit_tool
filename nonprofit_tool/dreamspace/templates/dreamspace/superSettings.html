<style>
    /* Custom gray theme for list group */
.list-group-gray .list-group-item {
    background-color: transparent; /* Light gray background */
    color: #495057; /* Darker text color */
}

.list-group-gray .list-group-item:hover {
    background-color: transparent;
}

.list-group-gray .list-group-item:first-child {
    border-top: none; /* Remove top border from the first item */
}
/* Ensure the dropdown is visible above the modal */
.ui-autocomplete {
    z-index: 1050 !important; /* Bootstrap 5 modals use a z-index of 1050 */
}
.tooltip-container {
    position: relative;
    display: inline-block;
    margin-left: 8px;
}

.tooltip-icon {
    font-size: 1.2em;
    color: #007bff; /* Bootstrap primary color */
    cursor: pointer;
}
#WebSiteList {
    display: flex;
    flex-wrap: wrap; /* Allows cards to wrap to the next line if there are too many */
    gap: 10px; /* Adds space between cards */
}
.tooltip-text {
    visibility: hidden;
    width: 300px;
    background-color: #333;
    color: #fff;
    text-align: left;
    border-radius: 5px;
    padding: 10px;
    position: absolute;
    z-index: 1;
    bottom: 125%; /* Position above the icon */
    left: 50%;
    margin-left: -150px; /* Center the tooltip */
    opacity: 0;
    transition: opacity 0.3s;
}

.tooltip-container:hover .tooltip-text {
    visibility: visible;
    opacity: 1;
}
.btn-group {
    display: flex;
    gap: 0.5rem; /* Space between buttons */
}

.btn {
    border-radius: 0.25rem; /* Rounded corners */
}

.btn i {
    margin-right: 0.5rem; /* Space between icon and text */
}

.btn-secondary {
    font-weight: bold; /* Make the "Show All" button text bold */
}

</style>
<div class="container-fluid mt-5">
    <!-- Tab navigation -->
    <ul class="nav nav-tabs" id="websiteTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <a class="nav-link active" id="dreamspace-tab" data-bs-toggle="tab" href="#dreamspace-content" role="tab" aria-controls="dreamspace" aria-selected="true">DreamSpace</a>
        </li>
    </ul>

    <!-- Tab content -->
    <div class="tab-content" id="websiteTabContent">
        <!-- DreamSpace tab -->
        <div class="tab-pane fade show active" id="dreamspace-content" role="tabpanel" aria-labelledby="dreamspace-tab">
            <!-- Add App Button and Search Input -->
            <div class="d-flex justify-content-between align-items-center mb-3">
                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addDreamSpaceModal">
                    Add DreamSpace
                </button>

                <!-- Search Input aligned to the far right -->
                <div class="ms-auto" style="width: 300px;">
                    <input type="text" id="websiteSearch" class="form-control" placeholder="Search by name or tag...">
                </div>
            </div>
            <div id="WebSiteList" class="mt-3"></div>
        </div>
    </div>
</div>

<!-- addDreamSpaceModal -->
<div class="modal fade" id="addDreamSpaceModal" tabindex="-1" aria-labelledby="addDreamSpaceModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addDreamSpaceModalLabel">DreamSpace</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Error container -->
                <div id="formErrors"></div>

                <form id="AddDreamSpaceForm">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label for="AddDreamSpaceName" class="form-label">Name</label>
                        <input type="text" class="form-control" id="AddDreamSpaceName" name="name" required>
                    </div>
                    <div class="mb-3">
                        <label for="AddDreamSpaceTags" class="form-label">
                            Tags
                            <span class="tooltip-container">
                                <i class="fas fa-question-circle tooltip-icon"></i>
                                <div class="tooltip-text">Tags help categorize and filter ideas based on themes, topics, or keywords.</div>
                            </span>
                        </label>
                        <input type="text" class="form-control" id="AddDreamSpaceTags" placeholder="Start typing to search tags...">
                        <input type="hidden" id="tags-input" name="tags">
                        <div id="tagsContainer"></div>
                    </div>
                    <div class="mb-3">
                        <label for="AddDreamSpaceDescription" class="form-label">Description</label>
                        <textarea class="form-control" id="AddDreamSpaceDescription" name="description" rows="3" required></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Add</button>
                </form>
            </div>
        </div>
    </div>
</div>
<!-- Add App Modal -->
<div class="modal fade" id="addApptoDreamSpaceModal" tabindex="-1" aria-labelledby="addApptoDreamSpaceModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="addApptoDreamSpaceModalLabel">Add New App</h5>
          <button type="button" onclick="hideAddAppModal()" class="btn-close" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="addApptoDreamSpaceForm">
            {% csrf_token %}
            <input type="hidden" id="hiddenWebsiteId" name="websiteId">
            <div class="mb-3">
              <label for="appName" class="form-label">App Name</label>
              <input type="text" class="form-control" name="appName" id="appName" placeholder="Enter app name">
            </div>
            <div class="mb-3">
                <label for="addAppTags" class="form-label">
                    Tags
                    <span class="tooltip-container">
                        <i class="fas fa-question-circle tooltip-icon"></i>
                        <div class="tooltip-text">Tags help categorize and filter ideas based on themes, topics, or keywords.</div>
                    </span>
                </label>
                <input type="text" class="form-control" id="addAppTags" placeholder="Start typing to search tags...">
                <input type="hidden" id="addApp-tags-input" name="tags">
                <div id="updateAddAppTagsContainer"></div>
            </div>
            <div class="mb-3">
              <label for="appDescription" class="form-label">App Description</label>
              <textarea class="form-control" id="appDescription" name="appDescription" rows="3" placeholder="Enter app description"></textarea>
            </div>
            <div class="mb-3 form-check">
                <input type="checkbox" class="form-check-input" id="isGlobalApp" name="isGlobal">
                <label class="form-check-label" for="isGlobalApp">Is this app global (for all websites)?</label>
            </div>
            <button type="submit" class="btn btn-primary">Add</button>
          </form>
        </div>
      </div>
    </div>
</div>
<!-- addFunctiontoAppModal -->
<div class="modal fade" id="addFunctiontoAppModal" tabindex="-1" aria-labelledby="addFunctiontoAppModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="addFunctiontoAppModalLabel">Add New Function</h5>
          <button type="button" onclick="hideaddFunctiontoAppModal()" class="btn-close" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="addFunctiontoAppForm">
            {% csrf_token %}
            <input type="hidden" id="hiddenAppId" name="appId">
            <input type="hidden" id="hiddenWebSiteId" name="webSiteId">
            <div class="mb-3">
              <label for="functionName" class="form-label">Function Name</label>
              <input type="text" class="form-control" name="functionName" id="functionName" placeholder="Enter function name">
            </div>
            <div class="mb-3">
                <label for="addAppTags" class="form-label">
                    Tags
                    <span class="tooltip-container">
                        <i class="fas fa-question-circle tooltip-icon"></i>
                        <div class="tooltip-text">Tags help categorize and filter ideas based on themes, topics, or keywords.</div>
                    </span>
                </label>
                <input type="text" class="form-control" id="addFunctionTags" placeholder="Start typing to search tags...">
                <input type="hidden" id="addFunction-tags-input" name="tags">
                <div id="updateAddFunctionTagsContainer"></div>
            </div>
            <div class="mb-3">
              <label for="functionDescription" class="form-label">App Description</label>
              <textarea class="form-control" id="functionDescription" name="Description" rows="3" placeholder="Enter app description"></textarea>
            </div>
            <div class="mb-3 form-check">
                <input type="checkbox" class="form-check-input" id="isGlobalFunction" name="isGlobal">
                <label class="form-check-label" id="isGlobalFunctionLable" for="isGlobalFunction">Is this function global (for all websites)?</label>
            </div>
            <button type="submit" class="btn btn-primary">Add</button>
          </form>
        </div>
      </div>
    </div>
</div>

<!-- addModeltoAppModal -->
<div class="modal fade" id="addModeltoAppModal" tabindex="-1" aria-labelledby="addModeltoAppModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="addModeltoAppModalLabel">Add New Model</h5>
          <button type="button" onclick="hideAddModeltoAppModal()" class="btn-close" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="addModeltoAppForm">
            {% csrf_token %}
            <input type="hidden" id="hiddenModelAppId" name="appId">
            <input type="hidden" id="hiddenModelWebSiteId" name="webSiteId">
            <div class="mb-3">
              <label for="modelName" class="form-label">Model Name</label>
              <input type="text" class="form-control" name="name" id="modelName" placeholder="Enter model name">
            </div>
            <div class="mb-3">
              <label for="modelDescription" class="form-label">Model Description</label>
              <textarea class="form-control" id="modelDescription" name="Description" rows="3" placeholder="Enter model description"></textarea>
            </div>
            <button type="submit" class="btn btn-primary">Add</button>
          </form>
        </div>
      </div>
    </div>
</div>


<div class="modal fade" id="addGlobalApptoDreamSpaceModal" tabindex="-1" aria-labelledby="addGlobalApptoDreamSpaceModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="addGlobalApptoDreamSpaceModalLabel">Add Global App</h5>
          <button type="button" onclick="hideAddGlobalAppModal()" class="btn-close" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            <div id="listGlobalApptoDreamSpace"></div>
        </div>
      </div>
    </div>
</div>


<script>

document.getElementById('main-dreamspace-tab').addEventListener('click', function() {
    loadWebsitesList();
});
let websitesData = [];
// Function to load the list of apps
function loadWebsitesList() {
    fetch("{% url 'list_website' %}")
    .then(response => response.json())
    .then(data => {
        websitesData = data.WebSite; // Store the data globally
        displayWebsites(websitesData); // Display the websites
    })
    .catch(error => alertMessage("Error loading app list: " + error, 'alert alert-danger'));
}
// Function to display the filtered websites
function displayWebsites(websites) {
    const WebSiteList = document.getElementById('WebSiteList');
    WebSiteList.innerHTML = ''; // Clear existing list

    websites.forEach(WebSite => {
        const WebSiteBox = document.createElement('div');
        WebSiteBox.className = 'card mb-2';
        WebSiteBox.style.width = '500px'; // Set the width to make it narrower
        WebSiteBox.style.position = 'relative'; // Enable positioning of the hamburger button
        WebSiteBox.style.border = WebSite.error ? '2px solid red' : (WebSite.active ? '2px solid green' : '2px solid orange');

        WebSiteBox.innerHTML = `
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="card-title" style="font-weight: bold;">${WebSite.name}</h5>
                    <!-- Hamburger Button at the top-right corner -->
                    <div class="dropdown" style="position: absolute; top: 10px; right: 10px;">
                        <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton-${WebSite.id}" data-bs-toggle="dropdown" aria-expanded="false">
                            &#9776; <!-- Three lines symbol -->
                        </button>
                        <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton-${WebSite.id}">
                            <li>
                                <button class="dropdown-item" type="button" data-app-id="${WebSite.id}" onclick="openEditTab(${WebSite.id}, '${WebSite.name}')">
                                    Edit
                                </button>
                            </li>
                            <li>
                                <button class="dropdown-item" type="button" data-app-id="${WebSite.id}" onclick="Logs(${WebSite.id}, '${WebSite.name}')">
                                    Logs
                                </button>
                            </li>
                        </ul>
                    </div>
                </div>
                <p class="card-text" style="color: #6c757d; font-size: 14px; margin-top: 10px;">${WebSite.description}</p>
                
            </div>
        `;

        WebSiteList.appendChild(WebSiteBox);
    });
}
let logIntervals = {};  // Store interval IDs for different tabs
let currentFilters = {};  // Store current filters for different tabs

function Logs(id, name) {
    // Check if the tab already exists

    const existingTab = document.getElementById(`tab-Logs-${id}`);
    if (existingTab) {
        // If the tab already exists, activate it
        const tab = new bootstrap.Tab(existingTab);
        tab.show();
        return;
    }

    // Create a new tab for editing the website
    const websiteTabs = document.getElementById('websiteTabs');
    const websiteTabContent = document.getElementById('websiteTabContent');

    const editTab = document.createElement('li');
    editTab.className = 'nav-item';
    editTab.innerHTML = `
        <a class="nav-link" id="tab-Logs-${id}" data-bs-toggle="tab" href="#logs-${id}" role="tab" aria-controls="edit-${id}" aria-selected="false">
            Logs: ${name}
            <button type="button" onclick="closeLogTabContent(${id})" class="close ms-2" aria-label="Close" style="color: white; padding-left: 10px;" data-tab-id="${id}">
                <span aria-hidden="true">&times;</span>
            </button>
        </a>
    `;
    websiteTabs.appendChild(editTab);

    const editTabPane = document.createElement('div');
    editTabPane.className = 'tab-pane fade';
    editTabPane.id = `logs-${id}`;
    editTabPane.role = 'tabpanel';
    editTabPane.ariaLabelledby = `tab-Logs-${id}`;

    editTabPane.innerHTML = `
        <div class="btn-group" role="group" aria-label="Log Filters">
            <button type="button" class="btn btn-danger me-2" onclick="filterLogs('error', '${id}')">
                <i class="bi bi-x-circle"></i> Error
            </button>
            <button type="button" class="btn btn-success me-2" onclick="filterLogs('info', '${id}')">
                <i class="bi bi-info-circle"></i> Info
            </button>
            <button type="button" class="btn btn-warning me-2" onclick="filterLogs('debug', '${id}')">
                <i class="bi bi-bug"></i> Debug
            </button>
            <button type="button" class="btn btn-secondary" onclick="filterLogs('all', '${id}')">
                <i class="bi bi-filter"></i> Show All
            </button>
        </div>
        <div class="card-body" id="logs-container-${id}">
            <!-- Logs will be loaded here -->
        </div>
    `;
    websiteTabContent.appendChild(editTabPane);

    // Activate the new tab
    const tab = new bootstrap.Tab(editTab.querySelector('a'));
    tab.show();

    // Initialize filter type for this tab
    currentFilters[id] = 'all';

    // Fetch and display logs
    loadLogs(id);
}

function closeLogTabContent(id) {
    // Remove the tab link
    const tabLink = document.getElementById(`tab-Logs-${id}`);
    const tabPane = document.getElementById(`logs-${id}`);

    if (tabLink) {
        // Remove the tab link
        tabLink.parentElement.remove();

        // Remove the corresponding tab pane
        if (tabPane) {
            tabPane.remove();
        }

        // Activate the first tab if available
        const firstTab = document.querySelector('#websiteTabs .nav-link');
        if (firstTab) {
            const firstTabPaneId = firstTab.getAttribute('href').substring(1);
            const firstTabPane = document.getElementById(firstTabPaneId);
            if (firstTabPane) {
                firstTab.classList.add('active');
                firstTabPane.classList.add('show', 'active');
            }
        }
    }
}
function fetchLogs(id) {
    const filter = currentFilters[id] || 'all';  // Use the stored filter type

    fetch(`/dreamspace/list-logs/${id}/?filter=${filter}`)
        .then(response => response.json())
        .then(data => {
            allLogs = data.logs;  // Store logs globally
            filterLogs(filter, id);  // Apply the current filter
        })
        .catch(error => console.error('Error fetching logs:', error));
}

function filterLogs(type, id) {
    const logsContainer = document.getElementById(`logs-container-${id}`);

    if (!logsContainer) {
        console.error('Logs container not found');
        return;
    }

    // Store the current filter type for this tab
    currentFilters[id] = type;

    // If 'all' is selected, show all logs
    let filteredLogs = [];
    if (type === 'all') {
        filteredLogs = allLogs;
    } else {
        // Filter logs based on type
        filteredLogs = allLogs.filter(log => log.type.toLowerCase() === type.toLowerCase());
    }

    // Update the container with filtered logs
    logsContainer.innerHTML = filteredLogs.map(log => {
        let borderColor;
        switch (log.type.toLowerCase()) {
            case 'error':
                borderColor = '2px solid red';
                break;
            case 'info':
                borderColor = '2px solid green';
                break;
            default:
                borderColor = '2px solid orange';
                break;
        }
        return `
            <div class="card mb-2" style="border: ${borderColor};">
                <div class="card-body">
                    <p class="card-text"><strong>Message:</strong> ${log.message}</p>
                    <p class="card-text"><strong>Timestamp:</strong> ${new Date(log.timestamp).toLocaleString()}</p>
                </div>
            </div>
        `;
    }).join('');
}

function loadLogs(id) {
    // Initial load of logs with the current filter
    fetchLogs(id);

    // Set up an interval to reload logs every 10 seconds (10000 milliseconds)
    if (logIntervals[id]) {
        clearInterval(logIntervals[id]);  // Clear previous interval if it exists
    }
    logIntervals[id] = setInterval(() => fetchLogs(id), 10000);

    // Handle tab close functionality
    document.querySelector(`button[data-tab-id="${id}"]`).addEventListener('click', () => {
        if (logIntervals[id]) {
            clearInterval(logIntervals[id]);  // Stop the interval when the tab is closed
            delete logIntervals[id];  // Remove the interval ID from the object
        }
    });
}



function openEditTab(id) {

    const existingTab = document.getElementById(`edit-tab-${id}`);
    const Tab = document.getElementById(`edit-${id}`);
    
    if (existingTab) {
        // If the tab already exists, activate it
        const tab = new bootstrap.Tab(existingTab);
        tab.show();
        return;
    }

    fetch(`/dreamspace/fetch-website/${id}/`)
        .then(response => response.json())
        .then(website_data => {
            const websiteTabs = document.getElementById('websiteTabs');
            const websiteTabContent = document.getElementById('websiteTabContent');

            const editTab = document.createElement('li');
            editTab.className = 'nav-item';
            editTab.innerHTML = `
                <a class="nav-link" id="edit-tab-${id}" data-bs-toggle="tab" href="#edit-${id}" role="tab" aria-controls="edit-${id}" aria-selected="false">
                    ${website_data.name}
                    <button type="button" onclick="closeWebsiteTabContent(${id})" class="close ms-2" aria-label="Close" style="color: white; padding-left: 10px;" data-tab-id="${id}">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </a>
            `;
            websiteTabs.appendChild(editTab);

            const TabPane = document.createElement('div');
            TabPane.className = 'tab-pane fade';
            TabPane.id = `edit-${id}`;
            TabPane.role = 'tabpanel';
            TabPane.ariaLabelledby = `edit-tab-${id}`;
            TabPane.style.margin = 0;
            TabPane.style.padding = 0;


            // Create the inner HTML for the app box
            const editBox = document.createElement('div');
            editBox.className = 'card mb-2';
            editBox.style.border = 'none';
            editBox.style.boxShadow = 'none';
            editBox.id = `edit-Box-${id}`;
            editBox.style.width = '100%'; // Set the width to make it narrower
            editBox.style.position = 'relative'; // Enable positioning of the hamburger button
            
            editBox.innerHTML = `
                <div class="card-body" >
                    <ul class="nav nav-tabs mt-3" id="appTab-${id}" role="tablist">
                        <li class="nav-item" role="presentation">
                            <a class="nav-link active" id="status-tab-${id}" data-bs-toggle="tab" href="#status-${id}" role="tab" aria-controls="status-${id}" aria-selected="true">Status</a>
                        </li>
                        <li class="nav-item" role="presentation">
                            <a class="nav-link" id="frontend-tab-${id}" data-bs-toggle="tab" href="#frontend-${id}" role="tab" aria-controls="frontend-${id}" aria-selected="false">Frontend</a>
                        </li>
                        <li class="nav-item" role="presentation">
                            <a class="nav-link" id="backend-tab-${id}" data-bs-toggle="tab" href="#backend-${id}" role="tab" aria-controls="backend-${id}" aria-selected="false">Backend</a>
                        </li>
                        <li class="nav-item" role="presentation">
                            <a class="nav-link" id="settings-tab-${id}" data-bs-toggle="tab" href="#settings-${id}" role="tab" aria-controls="settings-${id}" aria-selected="false">Settings</a>
                        </li>
                    </ul>
                    <div class="tab-content mt-3">
                        <div class="tab-pane fade show active" id="status-${id}" role="tabpanel" aria-labelledby="status-tab-${id}">
                            <div class="container mt-3">
                                <div class="row">
                                    <div class="col-12 mb-3">
                                        <h2>${website_data.name}</h2>
                                        <p class="text-muted">${website_data.description}</p>
                                        ${website_data.tags.length > 0 ? website_data.tags.map(tag => `<span class="badge bg-secondary m-1">${tag}</span>`).join('') : ''}                                    </div>
                                    
                                </div>
                                <div class="row">
                                    <!-- Website Details -->
                                    <div class="col-md-6 mb-3">
                                        <div class="card">
                                            <div class="card-body">
                                                <h5 class="card-title">Details</h5>
                                                <ul class="list-group list-group-flush list-group-gray">                                                   
                                                    <li class="list-group-item"><strong>Created At:</strong> ${new Date(website_data.created_at).toLocaleString()}</li>
                                                    <li class="list-group-item"><strong>Updated At:</strong> ${new Date(website_data.updated_at).toLocaleString()}</li>
                                                    <li class="list-group-item" style="background-color: ${website_data.is_active ? '#d4edda' : '#f8d7da'}; color: ${website_data.is_active ? '#155724' : '#721c24'};">
                                                        <strong>Status:</strong> ${website_data.is_active ? 'Active' : 'Inactive'}
                                                    </li>                                          
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="frontend-${id}" role="tabpanel" aria-labelledby="frontend-tab-${id}">
                            <!-- Frontend content goes here -->
                            Frontend content for ${website_data.name}
                        </div>
                        <div class="tab-pane fade" id="backend-${id}" role="tabpanel" aria-labelledby="backend-tab-${id}">
                            <!-- Backend content goes here -->
                            <div id="backend-content-${id}"></div>
                            <!-- You will add backend-specific content here -->
                        </div>
                        <div class="tab-pane fade" id="settings-${id}" role="tabpanel" aria-labelledby="settings-tab-${id}">
                            <!-- Settings content goes here -->
                            Settings content for ${website_data.name}
                        </div>
                    </div>
                </div>
            `;

            TabPane.appendChild(editBox);
            websiteTabContent.appendChild(TabPane);

            // Activate the new tab
            const tab = new bootstrap.Tab(editTab.querySelector('a'));
            tab.show();

            // Add event listener to load backend content when backend tab is shown
            document.querySelector(`#backend-tab-${id}`).addEventListener('shown.bs.tab', () => {
                list_Apps(id);
            });
        })
        .catch(error => console.error('Error fetching apps:', error));
}

function list_Apps(WebSite_id) {
    fetch(`/dreamspace/list-apps/${WebSite_id}/`)
        .then(response => response.json())
        .then(app_data => {
            const websiteTabContent = document.getElementById(`backend-content-${WebSite_id}`);
            websiteTabContent.style.display = 'flex';
            websiteTabContent.style.flexDirection = 'column'; // Stack items vertically
            websiteTabContent.style.gap = '10px'; // Optional: spacing between elements

            if (!websiteTabContent) {
                console.error(`Element with id backend-content-${WebSite_id} not found.`);
                return;
            }

            // Clear any previous content
            websiteTabContent.innerHTML = '';

            // Create a container for the button
            const buttonContainer = document.createElement('div');
            buttonContainer.id = `button-container-${WebSite_id}`;
            buttonContainer.style.marginBottom = '10px'; // Space between button and apps

            const addAppButton = document.createElement('button');
            addAppButton.className = 'btn btn-primary';
            addAppButton.innerHTML = 'New App';
            addAppButton.onclick = function() {
                $('#updateAddAppTagsContainer').empty();
                document.getElementById('hiddenWebsiteId').value = `${WebSite_id}`;
                const modal = new bootstrap.Modal(document.getElementById('addApptoDreamSpaceModal'));
                modal.show();
            };

            const addGolbalAppButton = document.createElement('button');
            addGolbalAppButton.className = 'btn btn-secondary';
            addGolbalAppButton.innerHTML = 'Gobal Apps';
            addGolbalAppButton.style.marginLeft = '5px';
            addGolbalAppButton.onclick = function() {
                listGlobalAppsForWebsite(WebSite_id);
            };
            // Append both buttons to the button container
            buttonContainer.appendChild(addAppButton);
            if (app_data.has_global_apps_not_in_website) {
                buttonContainer.appendChild(addGolbalAppButton);
            }
            websiteTabContent.appendChild(buttonContainer);

            // Create a container for the apps
            const appsContainer = document.createElement('div');
            appsContainer.style.display = 'flex';
            appsContainer.style.flexWrap = 'wrap';
            appsContainer.style.gap = '10px';

            // Function to handle app clicks
            function handleAppClick(app_id, WebSite_id) {
                // Remove the button container
                const buttonContainer = document.getElementById('button-container');
                if (buttonContainer) {
                    buttonContainer.remove();
                }
                
                // Hide all app cards
                appsContainer.style.display = 'none';

                // Create and display the app name only
                const appNameContainer = document.createElement('div');
                appNameContainer.className = 'app-name-container';
                appNameContainer.style.textAlign = 'center';
                appNameContainer.style.marginTop = '20px';

                list_Functions_for_app(app_id, WebSite_id)


            }

            // Listing existing apps
            app_data.apps.forEach(app => {
                const appBox = document.createElement('div');
                appBox.className = 'card mb-2';
                appBox.style.flex = '1 1 calc(33.33% - 10px)';
                appBox.style.maxWidth = '500px'; // Set the maximum width of each card
                appBox.style.position = 'relative'; // Enable positioning of the hamburger button
                appBox.style.border = app.error ? '2px solid red' : (app.active ? '2px solid green' : '2px solid orange');
                appBox.style.cursor = 'pointer';
                appBox.innerHTML = `
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <h5 class="card-title" style="font-weight: bold;">${app.name}</h5>
                        </div>
                        <p class="card-text" style="color: #6c757d; font-size: 14px; margin-top: 10px;">${app.description}</p>
                    </div>
                `;

                // Add click event to appBox
                appBox.onclick = function() {
                    handleAppClick(app.id, WebSite_id);
                };

                appsContainer.appendChild(appBox);
            });

            websiteTabContent.appendChild(appsContainer);
        })
        .catch(error => console.error('Error fetching app data:', error));
}

function list_Functions_for_app(app_id, WebSite_id) {

    fetch(`/dreamspace/list-app-data/${app_id}/`)
    .then(response => response.json())
    .then(function_data => {
        const appTabContent = document.getElementById(`backend-content-${WebSite_id}`);

        // Clear any previous content
        appTabContent.innerHTML = '';

        // Create a container for the buttons
        const buttonContainer = document.createElement('div');
        buttonContainer.id = `button-container-${WebSite_id}`;
        buttonContainer.style.display = 'flex'; // Make the container a flexbox
        buttonContainer.style.alignItems = 'center'; // Align items in the center
        buttonContainer.style.marginBottom = '10px'; // Space between button container and other elements
        buttonContainer.style.gap = '2px'; // Space between buttons

        // Create the "Add New Function" button
        const addfunctionButton = document.createElement('button');
        addfunctionButton.className = 'btn btn-primary';
        addfunctionButton.innerHTML = 'Add Function';
        addfunctionButton.onclick = function() {
            $('#updateAddFunctionTagsContainer').empty();
            document.getElementById('functionName').value = '';
            document.getElementById('functionDescription').value = '';
            document.getElementById('addFunction-tags-input').value = '';
            document.getElementById('hiddenAppId').value = `${app_id}`;
            document.getElementById('hiddenWebSiteId').value = `${WebSite_id}`;
            if (!function_data.is_global) {
                document.getElementById('isGlobalFunction').style.display = 'none';
                document.getElementById('isGlobalFunctionLable').style.display = 'none';
            }else{
                document.getElementById('isGlobalFunction').checked = true;
            }
            const modal = new bootstrap.Modal(document.getElementById('addFunctiontoAppModal'));
            modal.show();
        };

        // Create the "Add New Model" button
        const addModelButton = document.createElement('button');
        addModelButton.className = 'btn btn-secondary'; // Adjust the class if needed for styling
        addModelButton.innerHTML = 'Add Model';
        addModelButton.onclick = function() {
            document.getElementById('modelName').value = '';
            document.getElementById('modelDescription').value = '';
            document.getElementById('hiddenModelAppId').value = `${app_id}`;
            document.getElementById('hiddenModelWebSiteId').value = `${WebSite_id}`;
            const modal = new bootstrap.Modal(document.getElementById('addModeltoAppModal'));
            modal.show();
        };

        // Create the right-side navigation for apps
        const Nav = document.createElement('nav');
        Nav.style.display = 'flex'; // Ensure both items are on the same line
        Nav.style.alignItems = 'center'; // Vertically center the items
        Nav.style.overflowX = 'auto'; // Allow horizontal scrolling if needed
        Nav.style.marginLeft = 'auto'; // Push the nav to the right side

        // Create a clickable link or button that triggers list_Apps(WebSite_id)
        const NavButton = document.createElement('button');
        NavButton.className = 'btn btn-link'; // Style it as a link
        NavButton.style.display = 'flex';
        NavButton.style.alignItems = 'center'; // Ensure the button is vertically centered
        NavButton.innerHTML = '<h5>Apps</h5>'; // Remove extra margin from the <h5> tag
        NavButton.onclick = function() {
            list_Apps(WebSite_id); // Call the function when clicked
        };

        // Create a span to display the app name, not clickable
        const NameSpan = document.createElement('span');
        NameSpan.style.display = 'flex';
        NameSpan.style.alignItems = 'center'; // Ensure the name is vertically centered
        NameSpan.style.marginLeft = '5px'; // Add space between "Apps" and the app name
        NameSpan.style.whiteSpace = 'nowrap'; // Prevent wrapping of the text
        NameSpan.style.overflow = 'hidden'; // Hide any overflow if the text is too long
        NameSpan.style.textOverflow = 'ellipsis'; // Add ellipsis if the text is too long
        NameSpan.innerHTML = `<h5 style="display:inline; margin-left: 5px;">|&nbsp;&nbsp;&nbsp;&nbsp;${function_data.appName}</h5>`;


        // Append the button and name span to the navigation
        Nav.appendChild(NavButton);
        Nav.appendChild(NameSpan);


        // Append both to the button container
        buttonContainer.appendChild(addfunctionButton);
        buttonContainer.appendChild(addModelButton);
        buttonContainer.appendChild(Nav);

        // Append the button container to the website content
        appTabContent.appendChild(buttonContainer);

        // Create a container for the apps
        const addDataContainer = document.createElement('div');
        addDataContainer.id = `functions-container-${WebSite_id}`;
        addDataContainer.style.display = 'flex';
        addDataContainer.style.flexWrap = 'wrap';
        addDataContainer.style.gap = '10px';

        // Function to handle app clicks
        function handleAppClick(app_id, WebSite_id) {
            // Remove the button container
            const buttonContainer = document.getElementById('button-container');
            if (buttonContainer) {
                buttonContainer.remove();
            }
            
            // Hide all app cards
            addDataContainer.style.display = 'none';

            list_Functions_for_app(app_id, WebSite_id)
        }

        // Create containers for functions and models
        const functionsContainer = document.createElement('div');
        functionsContainer.style.border = '2px solid #495057'; // Border color
        functionsContainer.style.borderRadius = '5px'
        functionsContainer.style.padding = '10px'; // Padding inside the border
        functionsContainer.style.marginBottom = '20px'; // Space below the container
        functionsContainer.style.width = '100%';
        functionsContainer.style.display = 'flex';
        functionsContainer.style.flexWrap = 'wrap';

        // Add heading for functions
        const functionsHeading = document.createElement('h5');
        functionsHeading.textContent = 'Functions';
        functionsContainer.appendChild(functionsHeading);

        // Add a spacer element for spacing below the heading
        const functionsSpacer = document.createElement('div');
        functionsSpacer.style.width = '100%'; // Make the spacer full width
        functionsSpacer.style.height = '10px'; // Adjust height as needed
        functionsContainer.appendChild(functionsSpacer);       

        // Create containers for models
        const modelsContainer = document.createElement('div');
        modelsContainer.style.border = '2px solid #495057'; // Border color
        modelsContainer.style.borderRadius = '5px'
        modelsContainer.style.padding = '10px'; // Padding inside the border
        modelsContainer.style.marginBottom = '20px'; // Space below the container
        modelsContainer.style.width = '100%';
        modelsContainer.style.display = 'flex';
        modelsContainer.style.flexWrap = 'wrap';

        // Add heading for models
        const modelsHeading = document.createElement('h5');
        modelsHeading.textContent = 'Models';
        modelsContainer.appendChild(modelsHeading);

        // Add a spacer element for spacing below the heading
        const modelsSpacer = document.createElement('div');
        modelsSpacer.style.width = '100%'; // Make the spacer full width
        modelsSpacer.style.height = '10px'; // Adjust height as needed
        modelsContainer.appendChild(modelsSpacer);


        // Add the containers to the main container (assumed to be `addDataContainer`)
        if (function_data.functions_count > 0) {
            addDataContainer.appendChild(functionsContainer);
        }
        if (function_data.models_count > 0) {
            addDataContainer.appendChild(modelsContainer);
        }

        // Listing existing functions
        function_data.functions.forEach(functions => {
            const functionsBox = document.createElement('div');
            functionsBox.className = 'card mb-2';
            functionsBox.style.flex = '1 1 calc(33.33% - 10px)';
            functionsBox.style.maxWidth = '400px'; // Set the maximum width of each card
            functionsBox.style.position = 'relative'; // Enable positioning of the hamburger button
            functionsBox.style.border = functions.error ? '2px solid red' : (functions.active ? '2px solid green' : '2px solid orange');
            functionsBox.style.marginRight = '10px';
            functionsBox.style.cursor = 'pointer';

            functionsBox.innerHTML = `
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="card-title" style="font-weight: bold;">${functions.name}</h5>
                    </div>
                    <p class="card-text" style="color: #6c757d; font-size: 14px; margin-top: 10px;">${functions.description}</p>
                </div>
            `;

            // Add click event to functionsBox
            functionsBox.onclick = function() {
                handleAppClick(app.id, WebSite_id);
            };

            // Append each functionsBox to the functionsContainer
            functionsContainer.appendChild(functionsBox);
        });

        // Listing existing models
        function_data.models.forEach(models => {
            const modelsBox = document.createElement('div');
            modelsBox.className = 'card mb-2';
            modelsBox.style.flex = '1 1 calc(33.33% - 10px)';
            modelsBox.style.maxWidth = '500px'; // Set the maximum width of each card
            modelsBox.style.position = 'relative'; // Enable positioning of the hamburger button
            modelsBox.style.marginRight = '10px';
            modelsBox.style.cursor = 'pointer';
            modelsBox.innerHTML = `
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="card-title" style="font-weight: bold;">${models.name}</h5>
                    </div>
                    <p class="card-text" style="color: #6c757d; font-size: 14px; margin-top: 10px;">${models.description}</p>
                </div>
            `;

            // Add click event to modelsBox
            modelsBox.onclick = function() {
                handleAppClick(app.id, WebSite_id);
            };

            // Append each modelsBox to the modelsContainer
            modelsContainer.appendChild(modelsBox);
        });


        appTabContent.appendChild(addDataContainer);
    })
    .catch(error => console.error('Error fetching app data:', error));
}

// Function to hide the modal
function hideAddAppModal() {
    const modalElement = document.getElementById('addApptoDreamSpaceModal');
    const modal = new bootstrap.Modal(modalElement);

    if (modalElement.classList.contains('show')) {
        modal.hide(); // Use Bootstrap's hide method
        modalElement.classList.remove('show'); // Ensure 'show' class is removed
        modalElement.style.display = 'none'; // Force-hide the modal if it's stuck
        document.body.classList.remove('modal-open'); // Remove 'modal-open' class from body
        document.querySelector('.modal-backdrop')?.remove(); // Remove backdrop if present
    } else {
        console.info("Modal is already hidden");
    }
}

// Function to hide the modal
function hideaddFunctiontoAppModal() {
    const modalElement = document.getElementById('addFunctiontoAppModal');
    const modal = new bootstrap.Modal(modalElement);

    if (modalElement.classList.contains('show')) {
        modal.hide(); // Use Bootstrap's hide method
        modalElement.classList.remove('show'); // Ensure 'show' class is removed
        modalElement.style.display = 'none'; // Force-hide the modal if it's stuck
        document.body.classList.remove('modal-open'); // Remove 'modal-open' class from body
        document.querySelector('.modal-backdrop')?.remove(); // Remove backdrop if present
    } else {
        console.info("Modal is already hidden");
    }
}
// Function to hide the modal
function hideaddFunctiontoAppModal() {
    const modalElement = document.getElementById('addFunctiontoAppModal');
    const modal = new bootstrap.Modal(modalElement);

    if (modalElement.classList.contains('show')) {
        modal.hide(); // Use Bootstrap's hide method
        modalElement.classList.remove('show'); // Ensure 'show' class is removed
        modalElement.style.display = 'none'; // Force-hide the modal if it's stuck
        document.body.classList.remove('modal-open'); // Remove 'modal-open' class from body
        document.querySelector('.modal-backdrop')?.remove(); // Remove backdrop if present
    } else {
        console.info("Modal is already hidden");
    }
}

// Function to hide the modal
function hideAddModeltoAppModal() {
    const modalElement = document.getElementById('addModeltoAppModal');
    const modal = new bootstrap.Modal(modalElement);

    if (modalElement.classList.contains('show')) {
        modal.hide(); // Use Bootstrap's hide method
        modalElement.classList.remove('show'); // Ensure 'show' class is removed
        modalElement.style.display = 'none'; // Force-hide the modal if it's stuck
        document.body.classList.remove('modal-open'); // Remove 'modal-open' class from body
        document.querySelector('.modal-backdrop')?.remove(); // Remove backdrop if present
    } else {
        console.info("Modal is already hidden");
    }
}

function listGlobalAppsForWebsite(WebSite_id) {
    fetch(`/dreamspace/list-global-apps/${WebSite_id}`) // Fetching global apps
        .then(response => response.json())
        .then(data => {
            const global_apps = data.global_apps; // Access the global_apps array from the response
            
            const globalAppContainer = document.getElementById('listGlobalApptoDreamSpace');
            if (!globalAppContainer) {
                console.error('Global app container not found.');
                return;
            }

            // Clear any previous content
            globalAppContainer.innerHTML = '';

            // Display global apps as buttons
            global_apps.forEach(app => {
                const appButton = document.createElement('button');
                appButton.className = 'btn btn-secondary mb-2'; // Styling the button
                appButton.innerHTML = `${app.name}`;
                appButton.onclick = function() {
                    // Call the function to save the global app to the website
                    addGlobalAppToWebsite(WebSite_id, app.id);
                };

                globalAppContainer.appendChild(appButton);
            });
            const modal = new bootstrap.Modal(document.getElementById('addGlobalApptoDreamSpaceModal'));
            modal.show();

        })
        .catch(error => console.error('Error fetching global apps:', error));
}

// Function to add the global app to the specific website
function addGlobalAppToWebsite(WebSite_id, App_id) {
    fetch(`/dreamspace/add-app-to-website/`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        },
        body: JSON.stringify({ website_id: WebSite_id, app_id: App_id })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {

            list_Apps(WebSite_id)
            hideAddGlobalAppModal();
            alertMessage("Global App Added to DreamSpace Successfullly", 'alert alert-success');
        } else {
            alert('Error adding app to the website.');
        }
    })
    .catch(error => console.error('Error adding app to website:', error));
}


// Function to hide the modal
function hideAddGlobalAppModal() {
    const modalElement = document.getElementById('addGlobalApptoDreamSpaceModal');
    const modal = new bootstrap.Modal(modalElement);

    if (modalElement.classList.contains('show')) {
        modal.hide(); // Use Bootstrap's hide method
        modalElement.classList.remove('show'); // Ensure 'show' class is removed
        modalElement.style.display = 'none'; // Force-hide the modal if it's stuck
        document.body.classList.remove('modal-open'); // Remove 'modal-open' class from body
        document.querySelector('.modal-backdrop')?.remove(); // Remove backdrop if present
    } else {
        console.info("Modal is already hidden");
    }
}


function closeWebsiteTabContent(id) {
    // Get the tab link and pane elements
    const tabLink = document.getElementById(`edit-tab-${id}`);
    const tabPane = document.getElementById(`edit-${id}`);
    const dreamSpaceTabLink = document.getElementById('dreamspace-tab');
    const dreamSpaceTabPane = document.getElementById('dreamspace-content');

    // Check if the tabLink exists and if it's not the dreamSpaceTabLink
    if (tabLink && tabLink !== dreamSpaceTabLink) {
        // Remove the tab link
        tabLink.parentElement.remove();
    }

    // Check if the tabPane exists and if it's not the dreamSpaceTabPane
    if (tabPane && tabPane !== dreamSpaceTabPane) {
        tabPane.remove();
    }

    // Ensure dreamSpaceTabLink has the 'active' class
    if (dreamSpaceTabLink) {
        dreamSpaceTabLink.classList.add('nav-link', 'active');
    }

    // Ensure dreamSpaceTabPane has the correct classes and scroll into view
    if (dreamSpaceTabPane) {
        dreamSpaceTabPane.classList.add('tab-pane', 'fade', 'show', 'active');
        dreamSpaceTabPane.scrollIntoView({ behavior: 'smooth' });
    }
}
// Add event listener to the search input
document.getElementById('websiteSearch').addEventListener('input', function(event) {
    const searchQuery = event.target.value.toLowerCase();
    
    // Filter websites based on name or tags
    const filteredWebsites = websitesData.filter(WebSite => {
        const nameMatches = WebSite.name.toLowerCase().includes(searchQuery);
        const tagsMatch = WebSite.tags && WebSite.tags.some(tag => tag.toLowerCase().includes(searchQuery));
        return nameMatches || tagsMatch;
    });

    displayWebsites(filteredWebsites);
});
document.getElementById('AddDreamSpaceName').addEventListener('input', function() {
    let words = this.value.split(' ');
    for (let i = 0; i < words.length; i++) {
        words[i] = words[i].charAt(0).toUpperCase() + words[i].slice(1).toLowerCase();
    }
    this.value = words.join(' ');
});

let tags = [];

// Function to update the hidden input and display tags
function updateTags() {
    $('#tags-input').val(tags.join(','));
    
    // Clear the existing tags container
    $('#tagsContainer').empty();
    
    // Append each tag to the tags container
    tags.forEach(tag => {
        $('#tagsContainer').append(`<span class="badge bg-primary m-1">${tag}</span>`);
    });
}

// Handle keydown event for AddDreamSpaceTags input
$('#AddDreamSpaceTags').on('keydown', function(e) {
    if (e.key === 'Enter') {
        e.preventDefault();
        const input = $(this).val().trim();
        if (input !== '' && !tags.includes(input)) {
            tags.push(input);
            $(this).val('');
            updateTags();
        }
    }
});

// Initialize autocomplete
$('#AddDreamSpaceTags').autocomplete({
    source: function(request, response) {
        $.ajax({
            url: "{% url 'tag_autocomplete' %}",
            dataType: 'json',
            data: {
                term: request.term
            },
            success: function(data) {
                response(data.tags);
            },
            error: function(xhr, status, error) {
                console.error('Error:', error);
            }
        });
    },
    select: function(event, ui) {
        if (!tags.includes(ui.item.value)) {
            tags.push(ui.item.value);
            $('#AddDreamSpaceTags').val('');
            updateTags();
        }
        return false;
    }
});

let AddAppTags = [];

// Function to update the hidden input and display tags
function updateAddAppTags() {
    $('#addApp-tags-input').val(AddAppTags.join(','));
    
    // Clear the existing tags container
    $('#updateAddAppTagsContainer').empty();
    
    // Append each tag to the tags container
    AddAppTags.forEach(tag => {
        $('#updateAddAppTagsContainer').append(`<span class="badge bg-secondary m-1">${tag}</span>`);
    });
}

// Handle keydown event for addAppTags input
$('#addAppTags').on('keydown', function(e) {
    if (e.key === 'Enter') {
        e.preventDefault();
        const input = $(this).val().trim();
        if (input !== '' && !AddAppTags.includes(input)) {
            AddAppTags.push(input);
            $(this).val('');
            updateAddAppTags();
        }
    }
});

// Initialize autocomplete
$('#addAppTags').autocomplete({
    source: function(request, response) {
        $.ajax({
            url: "{% url 'tag_autocomplete' %}", // Ensure this URL is correct
            dataType: 'json',
            data: {
                term: request.term
            },
            success: function(data) {
                response(data.tags); // Ensure `data.tags` is the correct path
            },
            error: function(xhr, status, error) {
                console.error('Error:', error);
                // Optionally show a message to the user
            }
        });
    },
    select: function(event, ui) {
        if (!AddAppTags.includes(ui.item.value)) {
            AddAppTags.push(ui.item.value);
            $('#addAppTags').val('');
            updateAddAppTags(); // Update the tags container
        }
        return false; // Prevents the value from being entered in the input field
    }
});
let addFunctionTags = [];
// Initialize autocomplete
$('#addFunctionTags').autocomplete({
    source: function(request, response) {
        $.ajax({
            url: "{% url 'tag_autocomplete' %}", // Ensure this URL is correct
            dataType: 'json',
            data: {
                term: request.term
            },
            success: function(data) {
                response(data.tags); // Ensure `data.tags` is the correct path
            },
            error: function(xhr, status, error) {
                console.error('Error:', error);
                // Optionally show a message to the user
            }
        });
    },
    select: function(event, ui) {
        if (!addFunctionTags.includes(ui.item.value)) {
            addFunctionTags.push(ui.item.value);
            $('#addFunctionTags').val('');
            updateAddFunctionTags(); 
        }
        return false; 
    }
});

// Function to update the hidden input and display tags
function updateAddFunctionTags() {
    $('#addFunction-tags-input').val(addFunctionTags.join(','));
    
    // Clear the existing tags container
    $('#updateAddFunctionTagsContainer').empty();
    
    // Append each tag to the tags container
    addFunctionTags.forEach(tag => {
        $('#updateAddFunctionTagsContainer').append(`<span class="badge bg-secondary m-1">${tag}</span>`);
    });
}
// Handle keydown event for addAppTags input
$('#addFunctionTags').on('keydown', function(e) {
    if (e.key === 'Enter') {
        e.preventDefault();
        const input = $(this).val().trim();
        if (input !== '' && !addFunctionTags.includes(input)) {
            addFunctionTags.push(input);
            $(this).val('');
            updateAddFunctionTags();
        }
    }
});


document.getElementById('AddDreamSpaceForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const form = e.target;
    const formData = new FormData(form);
    
    fetch("{% url 'add_website' %}", {
        method: "POST",
        headers: {
            'X-CSRFToken': formData.get('csrfmiddlewaretoken'),
        },
        body: formData,
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            $('#addDreamSpaceModal').modal('hide');
            $('#AddDreamSpaceForm')[0].reset();
            $('#tagsContainer').empty();
            $('#tags-input').val('');
            loadWebsitesList()
            openEditTab(data.id, data.name)
            alertMessage("DreamSpace Created", 'alert alert-success');
        } else {            
            if (data.errors) {
                alertMessage("Error: " + (data.errors || "Failed to save Website"), 'alert alert-danger');
            } else if (data.error) {
                alertMessage("Error: " + (data.error || "Failed to save Website"), 'alert alert-danger');
            }
        }
    })
    
    .catch(error => alertMessage("Error: " + (error || "Failed to save Website"), 'alert alert-danger'));

});

document.getElementById('addApptoDreamSpaceForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const form = e.target;
    const formData = new FormData(form);
    
    fetch("{% url 'add_app_to_dreamspace' %}", {
        method: "POST",
        headers: {
            'X-CSRFToken': formData.get('csrfmiddlewaretoken'),
        },
        body: formData,
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            list_Apps(data.webSite_id)
            hideAddAppModal();
            alertMessage("App Added to DreamSpace Successfullly", 'alert alert-success');
        } else {            
            if (data.errors) {
                alertMessage("Error: " + (data.errors || "Failed to App Added to DreamSpace"), 'alert alert-danger');
            } else if (data.error) {
                alertMessage("Error: " + (data.error || "Failed to App Added to DreamSpace"), 'alert alert-danger');
            }
        }
    })
    
    .catch(error => alertMessage("Error: " + (error || "Failed to App Added to DreamSpace"), 'alert alert-danger'));

});
document.getElementById('addFunctiontoAppForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const form = e.target;
    const formData = new FormData(form);
    // Hide all content inside the modal and show a "Saving Function" message
    const modalBody = document.querySelector('#addFunctiontoAppModal .modal-body');
    const submitButton = form.querySelector('button[type="submit"]');
    submitButton.style.display = 'none';
    modalBody.innerHTML = '<div class="text-center"><p>Saving Function...</p></div>';

    fetch("{% url 'add_function_to_app' %}", {
        method: "POST",
        headers: {
            'X-CSRFToken': formData.get('csrfmiddlewaretoken'),
        },
        body: formData,
    })

    .then(response => response.json())
    .then(data => {
        if (data.success) {
            modalBody.innerHTML = '';
            modalBody.innerHTML = '<div class="text-center"><p>Writing Code...</p></div>';
            const webSite_id = data.webSite_id
            const app_id = data.app_id
            const function_id = data.function_id
            fetch(`/open_ai/write-functon-code/${function_id}/`, {
                method: "POST",
                headers: {
                    'X-CSRFToken': formData.get('csrfmiddlewaretoken'),
                },
            })    
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    list_Functions_for_app(app_id, webSite_id)
                    hideaddFunctiontoAppModal();
                    alertMessage("Function Added to App Successfullly", 'alert alert-success');

                }
            })

        } else {            
            if (data.errors) {
                alertMessage("Error: " + (data.errors || "Failed to Function Added to App"), 'alert alert-danger');
            } else if (data.error) {
                alertMessage("Error: " + (data.error || "Failed to Function Added to App"), 'alert alert-danger');
            }
        }
    })
    
    .catch(error => alertMessage("Error: " + (error || "Failed to Function Added to App"), 'alert alert-danger'));

});

document.getElementById('addModeltoAppForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const form = e.target;
    const formData = new FormData(form);

    // Hide all content inside the modal and show a "Saving Function" message
    const modalBody = document.querySelector('#addModeltoAppModal .modal-body');
    const submitButton = form.querySelector('button[type="submit"]');
    submitButton.style.display = 'none';
    modalBody.innerHTML = '<div class="text-center"><p>Saving Model...</p></div>';
    
    fetch("{% url 'add_model_to_app' %}", {
        method: "POST",
        headers: {
            'X-CSRFToken': formData.get('csrfmiddlewaretoken'),
        },
        body: formData,
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            modalBody.innerHTML = '';
            modalBody.innerHTML = '<div class="text-center"><p>Writing Code...</p></div>';
            const webSite_id = data.webSite_id
            const app_id = data.app_id
            const model_id = data.model_id
            fetch(`/open_ai/write-models-code/${model_id}/${app_id}/`, {
                method: "POST",
                headers: {
                    'X-CSRFToken': formData.get('csrfmiddlewaretoken'),
                },
            })    
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    list_Functions_for_app(app_id, webSite_id)
                    hideAddModeltoAppModal();
                    alertMessage("Model Added to App Successfullly", 'alert alert-success');

                }
            })
        } else {            
            if (data.errors) {
                alertMessage("Error: " + (data.errors || "Failed to Model Added to App"), 'alert alert-danger');
            } else if (data.error) {
                alertMessage("Error: " + (data.error || "Failed to Model Added to App"), 'alert alert-danger');
            }
        }
    })
    
    .catch(error => alertMessage("Error: " + (error || "Failed to Model Added to App"), 'alert alert-danger'));

});

</script>